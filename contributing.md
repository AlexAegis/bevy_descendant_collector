# Contributing

> This repository uses
> [`cargo-make`](https://github.com/sagiegurari/cargo-make). It takes care of
> installing all the required cargo extensions, rustup components, and git
> hooks used in this repository.

## Requirements

<!-- - [Git LFS](https://git-lfs.github.com/) -->
- [Latest Rust Stable](https://rustup.rs/)

## Setup

1. `cargo install cargo-make`
2. `cargo make setup`

### For Windows Users

Git hooks are written as shell scripts and won't be enabled on Windows.

### [`cargo-make`](https://github.com/sagiegurari/cargo-make) tasks

> See `Makefile.toml` for details

- `cargo make all` to run everything that could make CI fail (everything below)
- `cargo make build` to build all crates
- `cargo make test` to test all crates
- `cargo make format` to format all crates
- `cargo make lint` to lint all crates using `clippy` and `rustfmt`
- `cargo make book-build` to build the documentation book

## About Conventional Commits

This repository **enforces** the usage of
[conventional commits](https://www.conventionalcommits.org/en/v1.0.0/) for
automatic changelog generation.

If your PR has any commits that do not adhere to conventional commits, it will
be automatically **rejected**.

### [Cocogitto](https://docs.cocogitto.io/)

Cocogitto (`cog`) is used to verify that commit messages adhere to conventional
commits.

It runs as a CI step to enforce compliance and as a
[`commit-msg`](./scripts/hooks/commit-msg) hook to verify it locally.

#### Forgot to enable git hooks and accidentally made some non-compliant commits?

> [Cocogitto > Docs > Edit](https://docs.cocogitto.io/guide/edit.html)

Use `cog edit` to rewrite non-compliant commits. It performs a rebase, so the
edited commits will have different hashes. You'll have to `git push --force`.

### [Koji](https://github.com/cococonscious/koji)

Koji (`koji`), used as a git hook, helps you write commit messages that
adhere to conventional commits.

If you ran `cargo make setup`, you already have Koji and the git hooks
installed.

> If you want to disable Koji, set the `NO_KOJI` environment variable to any
> value.

- If you run `git commit` without a message, Koji will prompt you to assemble
  a commit message that adheres to conventional commits!
- If you run `git commit -m 'fix: I fixed something'` with a message that is
  correctly formatted, Koji will not do anything.
- For incomplete messages, Koji will use the message as the summary.

Note that Koji, by itself, does not enforce a correctly formatted commit; it
only helps create them.

## [release-plz](https://release-plz.dev/docs)

Release PR's are automatically generated by [release-plz](https://release-plz.dev/docs).
